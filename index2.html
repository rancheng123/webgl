<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <canvas id="canvas" style="width: 200px;height: 200px;border: 1px solid red;"></canvas>
    <script id="2d-vertex-shader" type="x-shader/x-vertex">
        attribute vec2 a_position;

        void main() {
          gl_Position = vec4(a_position, 0, 1);
        }
    </script>

    <script id="2d-fragment-shader" type="x-shader/x-fragment">
        void main() {
          gl_FragColor = vec4(0, 1, 0, 1);  // green
        }
    </script>

    <script>
        window.onload = ()=>{
            // Get A WebGL context
            var canvas = document.getElementById("canvas");
            var gl = canvas.getContext("experimental-webgl");


            //设置背景颜色
            //设置清除时背景色（rgba）
            gl.clearColor(0,255,255,1);
            //清除（应该叫设置。为什么叫清除，不知道）
            gl.clear(
                //颜色缓冲区
                gl.COLOR_BUFFER_BIT
            );




            //创建顶点着色器
            var vertexShader = gl.createShader(
                //顶点着色器
                gl.VERTEX_SHADER
            );
            //给着色器 设置源代码（c++源代码）
            gl.shaderSource(
                vertexShader,
                document.getElementById('2d-vertex-shader').innerText
            )
            //编译（汇编成 显卡可以执行的二进制代码）
            gl.compileShader(vertexShader);
            var compileStatus = gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)
            if(!compileStatus){
                console.err('编译失败');
                return;
            }




            //创建分片着色器
            var fragmentShader = gl.createShader(
                //顶点着色器
                gl.FRAGMENT_SHADER
            );
            //给着色器 设置源代码（c++源代码）
            gl.shaderSource(
                fragmentShader,
                document.getElementById('2d-fragment-shader').innerText
            )
            //编译（汇编成 显卡可以执行的二进制代码）
            gl.compileShader(fragmentShader);
            var compileStatus = gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)
            if(!compileStatus){

                var lastError = gl.getShaderInfoLog(fragmentShader);
                console.error("*** 编译失败 '" + fragmentShader + "':" + lastError);
                debugger
                // gl.deleteShader(shader);

                return;
            }






            //创建项目
            var program = gl.createProgram();

            //在项目上绑定着色器
            gl.attachShader(program,vertexShader);
            gl.attachShader(program,fragmentShader);
            //linkProgram  作用 不明白？？？？？？？？？？？？？？？？？？？？
            gl.linkProgram(program);
            var linked = gl.getProgramParameter(program, gl.LINK_STATUS);
            if (!linked) {
                // something went wrong with the link
                var lastError = gl.getProgramInfoLog (program);
                console.error("Error in program linking:" + lastError);

                gl.deleteProgram(program);
                return;
            }

            //项目没有link问题  就可以使用了
            gl.useProgram(program);



// look up where the vertex data needs to go.
            var positionLocation = gl.getAttribLocation(program, "a_position");

// Create a buffer and put a single clipspace rectangle in
// it (2 triangles)
            var buffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
            gl.bufferData(
                gl.ARRAY_BUFFER,
                new Float32Array([
                    -1.0, -1.0,
                    1.0, -1.0,
                    -1.0,  1.0,
                    -1.0,  1.0,
                    1.0, -1.0,
                    1.0,  1.0]),
                gl.STATIC_DRAW);
            gl.enableVertexAttribArray(positionLocation);
            gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

            // draw
            gl.drawArrays(gl.TRIANGLES, 0, 3);
















        }
    </script>
</body>
</html>